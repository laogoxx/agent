# å¾®ä¿¡æ”¯ä»˜æ¥å…¥é…ç½®æŒ‡å—

## ä¸€ã€å‰æœŸå‡†å¤‡

### 1. æ³¨å†Œå¾®ä¿¡æ”¯ä»˜å•†æˆ·å·

**è®¿é—®åœ°å€**ï¼šhttps://pay.weixin.qq.com

**ç”³è¯·ç±»å‹**ï¼š
- **å°å¾®å•†æˆ·**ï¼ˆé€‚åˆä¸ªäººå¼€å‘è€…ï¼‰
  - æ— éœ€è¥ä¸šæ‰§ç…§
  - æ—¥æ”¶æ¬¾é™é¢è¾ƒä½ï¼ˆé€šå¸¸1000-5000å…ƒï¼‰
  - å®¡æ ¸é€Ÿåº¦å¿«ï¼ˆ1-3å¤©ï¼‰
  - å®¡æ ¸è´¹ï¼š300å…ƒï¼ˆè®¤è¯åå¯æŠµæ‰£ï¼‰

- **æ™®é€šå•†æˆ·**ï¼ˆé€‚åˆä¼ä¸š/ä¸ªä½“å·¥å•†æˆ·ï¼‰
  - éœ€è¦è¥ä¸šæ‰§ç…§
  - æ”¶æ¬¾é™é¢æ— é™åˆ¶
  - å®¡æ ¸å‘¨æœŸè¾ƒé•¿ï¼ˆ3-7å¤©ï¼‰
  - å®¡æ ¸è´¹ï¼š300å…ƒï¼ˆè®¤è¯åå¯æŠµæ‰£ï¼‰

### 2. è·å–å¿…è¦å‡­è¯

åœ¨å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š

#### a) å•†æˆ·åŸºæœ¬ä¿¡æ¯
- **å•†æˆ·å·ï¼ˆmchidï¼‰**ï¼šåœ¨ã€Œè´¦æˆ·ä¸­å¿ƒã€â†’ã€Œå•†æˆ·ä¿¡æ¯ã€ä¸­æŸ¥çœ‹
- **åº”ç”¨IDï¼ˆappidï¼‰**ï¼šåœ¨ã€Œäº§å“ä¸­å¿ƒã€â†’ã€Œå¼€å‘é…ç½®ã€ä¸­é…ç½®

#### b) APIå¯†é’¥ä¸è¯ä¹¦
- **API v3 å¯†é’¥**ï¼š
  1. ç™»å½•å•†æˆ·å¹³å°
  2. è¿›å…¥ã€Œè´¦æˆ·ä¸­å¿ƒã€â†’ã€ŒAPI å®‰å…¨ã€
  3. ç‚¹å‡»ã€Œè®¾ç½® API v3 å¯†é’¥ã€
  4. ç”Ÿæˆ32ä½å¤§å°å†™å­—æ¯+æ•°å­—ç»„åˆï¼ˆå»ºè®®ä½¿ç”¨å¯†ç ç”Ÿæˆå·¥å…·ï¼‰
  5. ä¿å­˜å¯†é’¥ï¼Œ**åªæ˜¾ç¤ºä¸€æ¬¡**

- **å•†æˆ·APIè¯ä¹¦**ï¼š
  1. åœ¨ã€Œè´¦æˆ·ä¸­å¿ƒã€â†’ã€ŒAPI å®‰å…¨ã€â†’ã€ŒAPIè¯ä¹¦ã€é¡µé¢
  2. ç‚¹å‡»ã€Œç”³è¯·è¯ä¹¦ã€
  3. æŒ‰ç…§æŒ‡å¼•å®Œæˆè¯ä¹¦å®‰è£…
  4. ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶ï¼š
     - `apiclient_key.pem`ï¼ˆå•†æˆ·ç§é’¥ï¼‰
     - `apiclient_cert.pem`ï¼ˆå•†æˆ·è¯ä¹¦ï¼‰
     - `apiclient_cert.p12`ï¼ˆPKCS12æ ¼å¼è¯ä¹¦ï¼‰

#### c) è¯ä¹¦åºåˆ—å·
- æŸ¥çœ‹æ–¹æ³•ï¼š
  1. æ‰“å¼€ `apiclient_cert.pem` æ–‡ä»¶
  2. æŸ¥æ‰¾ `Serial Number` å­—æ®µ
  3. æˆ–ä½¿ç”¨å‘½ä»¤ï¼š`openssl x509 -in apiclient_cert.pem -noout -serial`

### 3. é…ç½®æ”¯ä»˜åœºæ™¯

#### å¼€é€šNativeæ”¯ä»˜
1. è¿›å…¥ã€Œäº§å“ä¸­å¿ƒã€
2. æ‰¾åˆ°ã€ŒNativeæ”¯ä»˜ã€
3. ç‚¹å‡»ã€Œå¼€é€šã€

#### é…ç½®å›è°ƒåœ°å€
1. è¿›å…¥ã€Œäº§å“ä¸­å¿ƒã€â†’ã€Œå¼€å‘é…ç½®ã€
2. æ‰¾åˆ°ã€ŒNativeæ”¯ä»˜ã€
3. é…ç½®æ”¯ä»˜ç»“æœå›è°ƒURLï¼ˆå¦‚ï¼š`https://your-domain.com/api/pay/notify`ï¼‰

## äºŒã€ç¯å¢ƒé…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
pip install wechatpayv3 qrcode
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `config/payment_config.json`ï¼š

```json
{
    "wechat_pay": {
        "mchid": "ä½ çš„å•†æˆ·å·",
        "appid": "ä½ çš„åº”ç”¨ID",
        "apiv3_key": "ä½ çš„APIv3å¯†é’¥",
        "cert_serial_no": "ä½ çš„è¯ä¹¦åºåˆ—å·",
        "private_key_path": "config/certs/apiclient_key.pem",
        "cert_dir": "config/certs",
        "notify_url": "https://your-domain.com/api/pay/notify"
    }
}
```

### 3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_PAY_MCHID=ä½ çš„å•†æˆ·å·
WECHAT_PAY_APPID=ä½ çš„åº”ç”¨ID
WECHAT_PAY_APIV3_KEY=ä½ çš„APIv3å¯†é’¥
WECHAT_PAY_CERT_SERIAL_NO=ä½ çš„è¯ä¹¦åºåˆ—å·
WECHAT_PAY_PRIVATE_KEY_PATH=config/certs/apiclient_key.pem
WECHAT_PAY_CERT_DIR=config/certs
WECHAT_PAY_NOTIFY_URL=https://your-domain.com/api/pay/notify
```

### 4. è¯ä¹¦æ–‡ä»¶å­˜æ”¾

åˆ›å»ºç›®å½•ç»“æ„ï¼š
```
config/
â”œâ”€â”€ payment_config.json
â””â”€â”€ certs/
    â”œâ”€â”€ apiclient_key.pem
    â”œâ”€â”€ apiclient_cert.pem
    â””â”€â”€ apiclient_cert.p12
```

**é‡è¦æé†’**ï¼š
- âš ï¸ è¯ä¹¦æ–‡ä»¶ç»ä¸èƒ½ä¸Šä¼ åˆ°Gitä»“åº“
- âš ï¸ è¯ä¹¦æ–‡ä»¶æƒé™è®¾ç½®ä¸º `600`ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
- âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å¯†é’¥

## ä¸‰ã€ä»£ç å®ç°

### 1. åˆ›å»ºå¾®ä¿¡æ”¯ä»˜å·¥å…·

åˆ›å»ºæ–‡ä»¶ `src/tools/wechat_pay.py`ï¼š

```python
import os
import json
from typing import Dict, Optional
from wechatpayv3 import WeChatPay, WeChatPayType
from langchain.tools import tool

# ä»é…ç½®æ–‡ä»¶åŠ è½½é…ç½®
def load_payment_config() -> Dict:
    """åŠ è½½æ”¯ä»˜é…ç½®"""
    workspace_path = os.getenv("COZE_WORKSPACE_PATH", "/workspace/projects")
    config_path = os.path.join(workspace_path, "config/payment_config.json")

    if os.path.exists(config_path):
        with open(config_path, 'r', encoding='utf-8') as f:
            return json.load(f)

    # å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä»ç¯å¢ƒå˜é‡åŠ è½½
    return {
        "mchid": os.getenv("WECHAT_PAY_MCHID"),
        "appid": os.getenv("WECHAT_PAY_APPID"),
        "apiv3_key": os.getenv("WECHAT_PAY_APIV3_KEY"),
        "cert_serial_no": os.getenv("WECHAT_PAY_CERT_SERIAL_NO"),
        "private_key_path": os.getenv("WECHAT_PAY_PRIVATE_KEY_PATH"),
        "cert_dir": os.getenv("WECHAT_PAY_CERT_DIR"),
        "notify_url": os.getenv("WECHAT_PAY_NOTIFY_URL")
    }

# åˆå§‹åŒ–å¾®ä¿¡æ”¯ä»˜å®¢æˆ·ç«¯
def get_wechatpay_client() -> WeChatPay:
    """è·å–å¾®ä¿¡æ”¯ä»˜å®¢æˆ·ç«¯"""
    config = load_payment_config()

    # è¯»å–å•†æˆ·ç§é’¥
    private_key_path = config.get("private_key_path")
    if not os.path.exists(private_key_path):
        raise FileNotFoundError(f"å•†æˆ·ç§é’¥æ–‡ä»¶ä¸å­˜åœ¨: {private_key_path}")

    with open(private_key_path, 'r', encoding='utf-8') as f:
        private_key = f.read()

    # åˆå§‹åŒ–å®¢æˆ·ç«¯
    wxpay = WeChatPay(
        wechatpay_type=WeChatPayType.NATIVE,
        mchid=config.get("mchid"),
        private_key=private_key,
        cert_serial_no=config.get("cert_serial_no"),
        apiv3_key=config.get("apiv3_key"),
        appid=config.get("appid"),
        notify_url=config.get("notify_url"),
        cert_dir=config.get("cert_dir")
    )

    return wxpay

@tool
def create_wechat_pay_order(
    out_trade_no: str,
    total: int,
    description: str
) -> str:
    """
    åˆ›å»ºå¾®ä¿¡æ”¯ä»˜Nativeæ”¯ä»˜è®¢å•

    Args:
        out_trade_no: å•†æˆ·è®¢å•å·ï¼ˆéœ€å”¯ä¸€ï¼‰
        total: è®¢å•é‡‘é¢ï¼Œå•ä½ä¸ºåˆ†ï¼ˆ1å…ƒ=100åˆ†ï¼‰
        description: å•†å“æè¿°

    Returns:
        str: æ”¯ä»˜äºŒç»´ç é“¾æ¥ï¼ˆcode_urlï¼‰

    Example:
        >>> create_wechat_pay_order("20240101001", 6800, "OPCåˆ›ä¸šæŒ‡å¯¼PDF")
        "weixin://wxpay/bizpayurl?pr=xxxxxxxx"
    """
    try:
        wxpay = get_wechatpay_client()

        # è°ƒç”¨Nativeæ”¯ä»˜ä¸‹å•æ¥å£
        response = wxpay.pay(
            description=description,
            out_trade_no=out_trade_no,
            amount={"total": total}
        )

        # è§£æå“åº”
        if response.get("code") == 200:
            result = json.loads(response.get("message", "{}"))
            code_url = result.get("code_url")
            return f"âœ… æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸï¼\n\nğŸ“± è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æä»¥ä¸‹äºŒç»´ç å®Œæˆæ”¯ä»˜ï¼š\n\n{code_url}\n\nğŸ’¡ æ”¯ä»˜é‡‘é¢ï¼š{total/100}å…ƒ\nğŸ“ è®¢å•å·ï¼š{out_trade_no}"
        else:
            return f"âŒ åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥ï¼š{response.get('message', 'æœªçŸ¥é”™è¯¯')}"

    except FileNotFoundError as e:
        return f"âŒ è¯ä¹¦æ–‡ä»¶æœªæ‰¾åˆ°ï¼š{str(e)}\n\nè¯·ç¡®è®¤å·²å®Œæˆå¾®ä¿¡æ”¯ä»˜é…ç½®ã€‚"
    except Exception as e:
        return f"âŒ åˆ›å»ºæ”¯ä»˜è®¢å•æ—¶å‘ç”Ÿé”™è¯¯ï¼š{str(e)}"

@tool
def query_wechat_pay_order(out_trade_no: str) -> str:
    """
    æŸ¥è¯¢å¾®ä¿¡æ”¯ä»˜è®¢å•çŠ¶æ€

    Args:
        out_trade_no: å•†æˆ·è®¢å•å·

    Returns:
        str: è®¢å•çŠ¶æ€ä¿¡æ¯

    Example:
        >>> query_wechat_pay_order("20240101001")
        "è®¢å•çŠ¶æ€ï¼šSUCCESS | äº¤æ˜“æ—¶é—´ï¼š2024-01-01 10:30:00"
    """
    try:
        wxpay = get_wechatpay_client()

        # æŸ¥è¯¢è®¢å•
        response = wxpay.query(out_trade_no=out_trade_no)

        if response.get("code") == 200:
            result = json.loads(response.get("message", "{}"))
            trade_state = result.get("trade_state", "UNKNOWN")
            trade_state_desc = result.get("trade_state_desc", "")

            state_map = {
                "SUCCESS": "æ”¯ä»˜æˆåŠŸ",
                "REFUND": "è½¬å…¥é€€æ¬¾",
                "NOTPAY": "æœªæ”¯ä»˜",
                "CLOSED": "å·²å…³é—­",
                "REVOKED": "å·²æ’¤é”€",
                "USERPAYING": "ç”¨æˆ·æ”¯ä»˜ä¸­",
                "PAYERROR": "æ”¯ä»˜å¤±è´¥"
            }

            status = state_map.get(trade_state, trade_state)
            return f"âœ… è®¢å•æŸ¥è¯¢æˆåŠŸ\n\nğŸ“ è®¢å•å·ï¼š{out_trade_no}\nğŸ“Š çŠ¶æ€ï¼š{status}ï¼ˆ{trade_state_desc}ï¼‰"
        else:
            return f"âŒ æŸ¥è¯¢è®¢å•å¤±è´¥ï¼š{response.get('message', 'æœªçŸ¥é”™è¯¯')}"

    except Exception as e:
        return f"âŒ æŸ¥è¯¢è®¢å•æ—¶å‘ç”Ÿé”™è¯¯ï¼š{str(e)}"
```

### 2. åˆ›å»ºæ”¯ä»˜å›è°ƒæ¥å£ï¼ˆFlaskç¤ºä¾‹ï¼‰

åˆ›å»ºæ–‡ä»¶ `src/payment_callback.py`ï¼š

```python
from flask import Flask, request, jsonify
from tools.wechat_pay import get_wechatpay_client
import json

app = Flask(__name__)

@app.route('/api/pay/notify', methods=['POST'])
def wechatpay_notify():
    """å¾®ä¿¡æ”¯ä»˜ç»“æœå›è°ƒæ¥å£"""
    try:
        wxpay = get_wechatpay_client()

        # è·å–å›è°ƒæ•°æ®å’Œç­¾å
        headers = {
            'Wechatpay-Timestamp': request.headers.get('Wechatpay-Timestamp'),
            'Wechatpay-Nonce': request.headers.get('Wechatpay-Nonce'),
            'Wechatpay-Signature': request.headers.get('Wechatpay-Signature'),
            'Wechatpay-Serial': request.headers.get('Wechatpay-Serial')
        }
        body = request.data.decode('utf-8')

        # éªŒè¯ç­¾åå¹¶è§£å¯†å›è°ƒæ•°æ®
        result = wxpay.callback(headers, body)

        # è§£æè®¢å•ä¿¡æ¯
        resource = result.get('resource', {})
        decrypt_data = json.loads(resource.get('ciphertext', '{}'))
        out_trade_no = decrypt_data.get('out_trade_no')
        trade_state = decrypt_data.get('trade_state')

        # TODO: å¤„ç†è®¢å•ä¸šåŠ¡é€»è¾‘
        # - æ›´æ–°è®¢å•çŠ¶æ€
        # - å‘é€PDFä¸‹è½½é“¾æ¥
        # - ç”Ÿæˆé‚€è¯·ç ç­‰

        print(f"æ”¯ä»˜å›è°ƒï¼šè®¢å•å·={out_trade_no}, çŠ¶æ€={trade_state}")

        # è¿”å›æˆåŠŸå“åº”
        return jsonify({"code": "SUCCESS", "message": "æˆåŠŸ"})

    except Exception as e:
        print(f"å¤„ç†æ”¯ä»˜å›è°ƒå¤±è´¥ï¼š{str(e)}")
        return jsonify({"code": "FAIL", "message": "å¤„ç†å¤±è´¥"}), 400

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

## å››ã€é›†æˆåˆ°Agent

### 1. æ³¨å†Œæ”¯ä»˜å·¥å…·

ä¿®æ”¹ `src/agents/agent.py`ï¼š

```python
from tools.wechat_pay import create_wechat_pay_order, query_wechat_pay_order

# åœ¨build_agentå‡½æ•°ä¸­æ·»åŠ å·¥å…·
tools = [
    generate_opc_pdf,
    show_payment_guide,
    get_wechat_group_info,
    create_wechat_pay_order,  # æ–°å¢
    query_wechat_pay_order    # æ–°å¢
]
```

### 2. æ›´æ–°System Prompt

ä¿®æ”¹ `config/agent_llm_config.json` ä¸­çš„æ”¯ä»˜å¼•å¯¼éƒ¨åˆ†ï¼š

```markdown
## ç¬¬å››é˜¶æ®µï¼šæ”¯ä»˜å¼•å¯¼
1. å®Œæˆæ¨èåï¼Œä»‹ç»å®Œæ•´çš„PDFåˆ›ä¸šæŒ‡å¯¼æ–‡æ¡£
2. è°ƒç”¨ `create_wechat_pay_order` å·¥å…·åˆ›å»ºæ”¯ä»˜è®¢å•
3. å·¥å…·å‚æ•°ï¼š
   - out_trade_no: ä½¿ç”¨æ—¶é—´æˆ³+éšæœºæ•°ç”Ÿæˆå”¯ä¸€è®¢å•å·
   - total: 6800ï¼ˆ68å…ƒï¼Œå•ä½ä¸ºåˆ†ï¼‰
   - description: "OPCåˆ›ä¸šæŒ‡å¯¼PDF"
4. å·¥å…·è¿”å›æ”¯ä»˜äºŒç»´ç é“¾æ¥
5. å‘Šè¯‰ç”¨æˆ·æ‰«ç æ”¯ä»˜åï¼Œå¯ä»¥è°ƒç”¨ `query_wechat_pay_order` æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
```

## äº”ã€æµ‹è¯•æµç¨‹

### 1. æµ‹è¯•ç¯å¢ƒé…ç½®

ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æ²™ç®±ç¯å¢ƒï¼š
- å•†æˆ·å¹³å° â†’ å¼€å‘é…ç½® â†’ æ²™ç®±ç¯å¢ƒ
- è·å–æ²™ç®±å•†æˆ·å·å’ŒAPIå¯†é’¥

### 2. æµ‹è¯•ä¸‹å•

```python
from tools.wechat_pay import create_wechat_pay_order
import time

# åˆ›å»ºæµ‹è¯•è®¢å•
order_no = f"TEST{int(time.time())}"
result = create_wechat_pay_order(order_no, 1, "æµ‹è¯•å•†å“")
print(result)
```

### 3. æŸ¥è¯¢è®¢å•

```python
from tools.wechat_pay import query_wechat_pay_order

result = query_wechat_pay_order(order_no)
print(result)
```

## å…­ã€å¸¸è§é—®é¢˜

### 1. è¯ä¹¦é”™è¯¯
**é—®é¢˜**ï¼š`æ— æ³•åŠ è½½å•†æˆ·ç§é’¥`
**è§£å†³**ï¼š
- ç¡®è®¤è¯ä¹¦æ–‡ä»¶è·¯å¾„æ­£ç¡®
- æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤è¯ä¹¦æ–‡ä»¶æƒé™ä¸º `600`

### 2. ç­¾åé”™è¯¯
**é—®é¢˜**ï¼š`ç­¾åéªŒè¯å¤±è´¥`
**è§£å†³**ï¼š
- ç¡®è®¤API v3å¯†é’¥é…ç½®æ­£ç¡®
- æ£€æŸ¥å•†æˆ·ç§é’¥å’Œè¯ä¹¦æ˜¯å¦åŒ¹é…
- ç¡®è®¤è¯ä¹¦åºåˆ—å·æ­£ç¡®

### 3. å›è°ƒåœ°å€é…ç½®
**é—®é¢˜**ï¼š`å›è°ƒåœ°å€æœªé…ç½®æˆ–æ— æ•ˆ`
**è§£å†³**ï¼š
- ç¡®è®¤å›è°ƒåœ°å€å·²é…ç½®åœ¨å•†æˆ·å¹³å°
- å›è°ƒåœ°å€å¿…é¡»æ˜¯HTTPS
- ç¡®è®¤æœåŠ¡å™¨é˜²ç«å¢™å¼€æ”¾ç›¸åº”ç«¯å£

### 4. é‡‘é¢é”™è¯¯
**é—®é¢˜**ï¼š`è®¢å•é‡‘é¢é”™è¯¯`
**è§£å†³**ï¼š
- é‡‘é¢å•ä½å¿…é¡»ä¸ºåˆ†ï¼ˆ1å…ƒ=100åˆ†ï¼‰
- é‡‘é¢å¿…é¡»æ˜¯æ•´æ•°
- ç¡®è®¤é‡‘é¢ä¸è¶…è¿‡å•†æˆ·é™é¢

## ä¸ƒã€å®‰å…¨å»ºè®®

1. **å¯†é’¥ç®¡ç†**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
   - å®šæœŸæ›´æ¢APIå¯†é’¥
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

2. **è¯ä¹¦ç®¡ç†**
   - è¯ä¹¦è¿‡æœŸå‰åŠæ—¶æ›´æ–°
   - ä½¿ç”¨SDKè‡ªåŠ¨æ›´æ–°å¹³å°è¯ä¹¦åŠŸèƒ½
   - è¯ä¹¦æ–‡ä»¶æƒé™è®¾ç½®ä¸º `600`

3. **å›è°ƒéªŒè¯**
   - åŠ¡å¿…éªŒè¯å›è°ƒç­¾å
   - éªŒè¯è®¢å•é‡‘é¢æ˜¯å¦åŒ¹é…
   - é˜²æ­¢é‡å¤å¤„ç†å›è°ƒ

4. **æ—¥å¿—è®°å½•**
   - è®°å½•æ‰€æœ‰æ”¯ä»˜ç›¸å…³æ—¥å¿—
   - ä¸è¦è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†é’¥ã€è¯ä¹¦ï¼‰
   - å®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—

## å…«ã€è´¹ç”¨è¯´æ˜

| é¡¹ç›® | è´¹ç”¨ | è¯´æ˜ |
|------|------|------|
| å•†æˆ·è®¤è¯è´¹ | 300å…ƒ | ä¸€æ¬¡æ€§è´¹ç”¨ï¼Œè®¤è¯åå¯æŠµæ‰£ |
| æ‰‹ç»­è´¹ | 0.6% | æ¯ç¬”äº¤æ˜“æ”¶å–0.6%æ‰‹ç»­è´¹ |
| ç»“ç®—å‘¨æœŸ | T+1 | æ¬¡æ—¥ç»“ç®—åˆ°å•†æˆ·é“¶è¡Œè´¦æˆ· |
| æç°è´¹ | 0.1å…ƒ/ç¬” | æç°åˆ°é“¶è¡Œå¡æ”¶è´¹ |

## ä¹ã€ä¸‹ä¸€æ­¥

1. å®Œæˆå¾®ä¿¡æ”¯ä»˜å•†æˆ·æ³¨å†Œ
2. è·å–å•†æˆ·å·ã€APIå¯†é’¥å’Œè¯ä¹¦
3. é…ç½®ç¯å¢ƒå˜é‡å’Œè¯ä¹¦æ–‡ä»¶
4. å®ç°æ”¯ä»˜å·¥å…·å’Œå›è°ƒæ¥å£
5. è¿›è¡Œæ²™ç®±ç¯å¢ƒæµ‹è¯•
6. åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

## åã€æ”¯æŒèµ„æº

- å¾®ä¿¡æ”¯ä»˜å®˜æ–¹æ–‡æ¡£ï¼šhttps://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml
- wechatpayv3 SDKæ–‡æ¡£ï¼šhttps://github.com/wechatpay-apiv3/wechatpay-python
- å•†æˆ·å¹³å°ï¼šhttps://pay.weixin.qq.com
- å¼€å‘è€…ç¤¾åŒºï¼šhttps://developers.weixin.qq.com/community/pay

---

**é…ç½®å®Œæˆåï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æµ‹è¯•ï¼š**
1. è¿è¡Œæ”¯ä»˜å›è°ƒæœåŠ¡ï¼š`python src/payment_callback.py`
2. è°ƒç”¨ `create_wechat_pay_order` åˆ›å»ºè®¢å•
3. æ‰«ç æ”¯ä»˜
4. æŸ¥çœ‹å›è°ƒæ—¥å¿—ç¡®è®¤æ”¯ä»˜æˆåŠŸ
5. è°ƒç”¨ `query_wechat_pay_order` æŸ¥è¯¢è®¢å•çŠ¶æ€
