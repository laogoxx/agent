# ðŸ“¦ éƒ¨ç½²ç›¸å…³æ–‡ä»¶è¯´æ˜Ž

æœ¬ç›®å½•åŒ…å«éƒ¨ç½²å’Œç®¡ç†OPC Agentæ‰€éœ€çš„è„šæœ¬å’Œæ–‡æ¡£ã€‚

---

## ðŸ“š æ–‡ä»¶è¯´æ˜Ž

### æ–‡æ¡£

| æ–‡ä»¶ | è¯´æ˜Ž |
|------|------|
| **[å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md](../docs/å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)** | 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆæŽ¨èæ–°æ‰‹ï¼‰ |
| **[éƒ¨ç½²æŒ‡å—.md](../docs/éƒ¨ç½²æŒ‡å—.md)** | å®Œæ•´çš„éƒ¨ç½²æŒ‡å—ï¼ˆåŒ…å«æ‰€æœ‰éƒ¨ç½²æ–¹å¼ï¼‰ |
| **[é…ç½®å®Œæˆæ€»ç»“.md](../docs/é…ç½®å®Œæˆæ€»ç»“.md)** | é…ç½®å®ŒæˆåŽçš„æ€»ç»“å’Œç»´æŠ¤æŒ‡å— |

### è„šæœ¬

| æ–‡ä»¶ | è¯´æ˜Ž | é€‚ç”¨ç³»ç»Ÿ |
|------|------|---------|
| **deploy.sh** | ä¸€é”®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ | Linux/Mac |
| **start.sh** | æœ¬åœ°å¯åŠ¨è„šæœ¬ | Linux/Mac |
| **start.bat** | æœ¬åœ°å¯åŠ¨è„šæœ¬ | Windows |

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### åœºæ™¯1ï¼šæœ¬åœ°æµ‹è¯•ï¼ˆWindowsï¼‰

```bash
# åŒå‡»è¿è¡Œ
start.bat

# æˆ–åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ
start.bat
```

### åœºæ™¯2ï¼šæœ¬åœ°æµ‹è¯•ï¼ˆLinux/Macï¼‰

```bash
# è¿è¡Œå¯åŠ¨è„šæœ¬
./scripts/start.sh

# æˆ–æŒ‡å®šç«¯å£
./scripts/start.sh 8000
```

### åœºæ™¯3ï¼šéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨

```bash
# 1. è¿žæŽ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /opt/opc-agent
cd /opt/opc-agent

# 3. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶ï¼ˆåœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼‰
scp -r /workspace/projects/* root@ä½ çš„æœåŠ¡å™¨IP:/opt/opc-agent/

# 4. è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰
chmod +x scripts/deploy.sh
./scripts/deploy.sh

# 5. é…ç½®çŽ¯å¢ƒå˜é‡
nano /opt/opc-agent/.env

# 6. é‡å¯æœåŠ¡
supervisorctl restart opc-agent
```

---

## ðŸ“‹ è¯¦ç»†æ­¥éª¤

### éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨
- [ ] å·²é…ç½® `.env` æ–‡ä»¶
- [ ] å·²æµ‹è¯•æœ¬åœ°è¿è¡Œ
- [ ] å·²ä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ°æœåŠ¡å™¨

### å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

1. **è¿žæŽ¥æœåŠ¡å™¨**
   ```bash
   ssh root@ä½ çš„æœåŠ¡å™¨IP
   ```

2. **ä¸Šä¼ é¡¹ç›®**
   ```bash
   scp -r /workspace/projects/* root@ä½ çš„æœåŠ¡å™¨IP:/opt/opc-agent/
   ```

3. **è¿è¡Œéƒ¨ç½²è„šæœ¬**
   ```bash
   cd /opt/opc-agent
   ./scripts/deploy.sh
   ```

4. **é…ç½®çŽ¯å¢ƒå˜é‡**
   ```bash
   nano .env
   # å¡«å†™ WECHAT_QRCODE_URL å’Œ WECHAT_GROUP_QRCODE_URL
   ```

5. **é‡å¯æœåŠ¡**
   ```bash
   supervisorctl restart opc-agent
   ```

6. **éªŒè¯éƒ¨ç½²**
   ```bash
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   supervisorctl status

   # æµ‹è¯•æœåŠ¡
   curl http://localhost:8080/api/health
   ```

---

## ðŸ”§ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†ï¼ˆäº‘æœåŠ¡å™¨ï¼‰

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
supervisorctl status

# é‡å¯æœåŠ¡
supervisorctl restart opc-agent

# åœæ­¢æœåŠ¡
supervisorctl stop opc-agent

# å¯åŠ¨æœåŠ¡
supervisorctl start opc-agent
```

### æ—¥å¿—æŸ¥çœ‹ï¼ˆäº‘æœåŠ¡å™¨ï¼‰

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/opc-agent.out.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/opc-agent.err.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -n 100 /var/log/opc-agent.out.log
```

### æœ¬åœ°å¯åŠ¨

```bash
# Linux/Mac
./scripts/start.sh

# Windows
start.bat
```

---

## ðŸ“Š æŽ¨èéƒ¨ç½²æ–¹æ¡ˆ

### å¯¹äºŽåˆå­¦è€…

**æŽ¨èï¼šä½¿ç”¨äº‘æœåŠ¡å™¨éƒ¨ç½²**

- äº‘æœåŠ¡å•†ï¼šé˜¿é‡Œäº‘æˆ–è…¾è®¯äº‘
- é…ç½®ï¼š2æ ¸2Gï¼ˆ60å…ƒ/æœˆï¼‰
- éƒ¨ç½²æ–¹å¼ï¼šä½¿ç”¨ `deploy.sh` ä¸€é”®éƒ¨ç½²
- é¢„è®¡æ—¶é—´ï¼š10åˆ†é’Ÿ

### å¯¹äºŽå¼€å‘è€…

**æŽ¨èï¼šæœ¬åœ°å¼€å‘ + äº‘æœåŠ¡å™¨éƒ¨ç½²**

- æœ¬åœ°å¼€å‘ï¼šä½¿ç”¨ `start.sh` æˆ– `start.bat`
- ç”Ÿäº§çŽ¯å¢ƒï¼šéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨
- é…å¥—å·¥å…·ï¼šGit + SCP

### å¯¹äºŽä¼ä¸š

**æŽ¨èï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²**

- å®¹å™¨åŒ–ï¼šä½¿ç”¨Dockerå’ŒDocker Compose
- ç¼–æŽ’ï¼šKubernetesï¼ˆå¯é€‰ï¼‰
- CI/CDï¼šGitHub Actionsæˆ–GitLab CI

---

## ðŸŒ è®¿é—®æœåŠ¡

### æœ¬åœ°è®¿é—®

```
http://localhost:8080
```

### äº‘æœåŠ¡å™¨è®¿é—®

```
http://ä½ çš„æœåŠ¡å™¨å…¬ç½‘IP:8080
```

### åŸŸåè®¿é—®ï¼ˆé…ç½®åŸŸååŽï¼‰

```
http://ä½ çš„åŸŸå
https://ä½ çš„åŸŸåï¼ˆé…ç½®SSLåŽï¼‰
```

---

## â“ å¸¸è§é—®é¢˜

### Q1ï¼šè„šæœ¬æ— æ³•æ‰§è¡Œ

**A**ï¼šæ·»åŠ å¯æ‰§è¡Œæƒé™
```bash
chmod +x scripts/deploy.sh
chmod +x scripts/start.sh
```

### Q2ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

**A**ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
tail -f /var/log/opc-agent.err.log
```

### Q3ï¼šæ— æ³•è®¿é—®æœåŠ¡

**A**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„
```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# å¼€æ”¾ç«¯å£
ufw allow 8080/tcp
```

### Q4ï¼šå¦‚ä½•æ›´æ–°ä»£ç 

**A**ï¼š
```bash
# 1. ä¸Šä¼ æ–°ä»£ç 
scp -r /workspace/projects/* root@ä½ çš„æœåŠ¡å™¨IP:/opt/opc-agent/

# 2. é‡å¯æœåŠ¡
supervisorctl restart opc-agent
```

---

## ðŸ“ž èŽ·å–å¸®åŠ©

### æ–‡æ¡£

- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](../docs/å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)
- [éƒ¨ç½²æŒ‡å—](../docs/éƒ¨ç½²æŒ‡å—.md)
- [é…ç½®å®Œæˆæ€»ç»“](../docs/é…ç½®å®Œæˆæ€»ç»“.md)

### æ—¥å¿—

- åº”ç”¨æ—¥å¿—ï¼š`/var/log/opc-agent.out.log`
- é”™è¯¯æ—¥å¿—ï¼š`/var/log/opc-agent.err.log`
- Nginxæ—¥å¿—ï¼š`/var/log/nginx/access.log`

### æµ‹è¯•

```bash
# æµ‹è¯•å®Œæ•´æµç¨‹
python tests/test_complete_flow.py

# æ¼”ç¤ºæ¬¢è¿ŽåŠŸèƒ½
python tests/demo_auto_welcome.py
```

---

## ðŸ’¡ æœ€ä½³å®žè·µ

### 1. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d)
tar -czf /backup/opc-agent-$DATE.tar.gz /opt/opc-agent
find /backup -name "opc-agent-*.tar.gz" -mtime +7 -delete
EOF

chmod +x /opt/backup.sh
crontab -e
# æ·»åŠ ï¼š0 3 * * * /opt/backup.sh
```

### 2. ç›‘æŽ§æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
supervisorctl status

# è®¾ç½®ç›‘æŽ§å‘Šè­¦ï¼ˆæŽ¨èï¼‰
# - ä½¿ç”¨äº‘æœåŠ¡å•†çš„ç›‘æŽ§åŠŸèƒ½
# - é…ç½®é‚®ä»¶æˆ–çŸ­ä¿¡å‘Šè­¦
```

### 3. æ›´æ–°ç»´æŠ¤

```bash
# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# æ›´æ–°Pythonä¾èµ–
cd /opt/opc-agent
source venv/bin/activate
pip install --upgrade -r requirements.txt

# é‡å¯æœåŠ¡
supervisorctl restart opc-agent
```

---

## ðŸŽ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰

- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨
- [ ] å·²é…ç½® `.env` æ–‡ä»¶
- [ ] å·²æµ‹è¯•æœ¬åœ°è¿è¡Œ
- [ ] å·²ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

### éƒ¨ç½²åŽ

- [ ] æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å¯ä»¥è®¿é—®æœåŠ¡
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ—¥å¿—æ— é”™è¯¯
- [ ] é…ç½®é˜²ç«å¢™
- [ ] ï¼ˆå¯é€‰ï¼‰é…ç½®åŸŸåå’ŒHTTPS

### æ—¥å¸¸ç»´æŠ¤

- [ ] æ¯æ—¥æ£€æŸ¥æœåŠ¡çŠ¶æ€
- [ ] æ¯å‘¨æ£€æŸ¥æ—¥å¿—
- [ ] æ¯æœˆæ›´æ–°ç³»ç»Ÿ
- [ ] å®šæœŸå¤‡ä»½æ•°æ®

---

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼** ðŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚
