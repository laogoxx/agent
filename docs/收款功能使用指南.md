# OPC创业指导助手 - 收款功能使用指南

## 📋 概述

本项目提供两种收款方式：
1. **简单收款码**（推荐，5分钟配置完成）
2. **微信支付商户号**（需要资质，3-7天审核）

---

## 🚀 快速开始（推荐简单收款码）

### 步骤1：获取个人收款码（3分钟）

**微信收款码**：
```
1. 打开微信
2. 点击「我」→「支付」→「收付款」
3. 点击「收款码」
4. 截图保存收款码
```

**支付宝收款码**：
```
1. 打开支付宝
2. 点击「首页」右上角的「+」
3. 点击「收钱」
4. 截图保存收款码
```

### 步骤2：上传收款码到图床（2分钟）

推荐免费图床：
- **ImgBB**：https://imgbb.com/（推荐）
- **七牛云**：https://www.qiniu.com/
- **阿里云OSS**：https://www.aliyun.com/product/oss

**以ImgBB为例**：
```
1. 访问 https://imgbb.com/
2. 点击「开始上传」
3. 选择收款码图片
4. 上传完成后复制「直接链接」
5. 将链接保存到配置文件中
```

### 步骤3：配置收款信息（1分钟）

**方式一：使用环境变量**

编辑 `.env` 文件：
```bash
# 微信收款码图片URL
WECHAT_QRCODE_URL=https://i.ibb.co/xxx/wechat-qrcode.png

# 支付宝收款码图片URL
ALIPAY_QRCODE_URL=https://i.ibb.co/xxx/alipay-qrcode.png

# 收款金额（元）
PAYMENT_PRICE=68.00

# 商品名称
PRODUCT_NAME=OPC创业指导PDF
```

**方式二：使用JSON配置**

编辑 `config/payment_config.json`：
```json
{
    "simple_payment": {
        "payment_method": "qrcode",
        "wechat_qrcode_url": "https://i.ibb.co/xxx/wechat-qrcode.png",
        "alipay_qrcode_url": "https://i.ibb.co/xxx/alipay-qrcode.png",
        "wechat_account": "your_wechat_id",
        "alipay_account": "your_alipay_id",
        "price": 68.00,
        "product_name": "OPC创业指导PDF"
    }
}
```

### 步骤4：测试收款功能

运行测试脚本：
```bash
python tests/test_simple_payment.py
```

预期输出：
```
============================================================
开始测试简单收款工具
============================================================
============================================================
测试1: 获取收款码
============================================================
✓ 获取收款码成功
返回结果:
💰 **支付方式**

📦 **商品**：OPC创业指导PDF
💵 **价格**：¥68.00
...
============================================================
测试结果摘要
============================================================
获取收款码: ✓ 通过
确认支付: ✓ 通过

总计: 2 通过, 0 失败
============================================================
```

---

## 🔧 集成到Agent

修改 `src/agents/agent.py`：

```python
from src.tools.simple_payment import SIMPLE_PAYMENT_TOOLS
from src.tools.pdf_generator import generate_opc_pdf
from src.tools.wechat_group_info import get_wechat_group_info

def build_agent(ctx=None):
    # ... 其他代码 ...

    # 添加收款工具
    tools = [
        generate_opc_pdf,
        get_wechat_group_info,
        *SIMPLE_PAYMENT_TOOLS  # 添加收款工具
    ]

    return create_agent(
        model=llm,
        system_prompt=cfg.get("sp"),
        tools=tools,
        checkpointer=get_memory_saver(),
        state_schema=AgentState,
    )
```

更新 `config/agent_llm_config.json` 中的System Prompt：

```markdown
# 角色定义
你是OPC（一人公司）超级个体孵化助手，专注于帮助用户发现、规划和启动适合的创业项目。

# 任务目标
通过对话收集用户信息，推荐创业项目，生成包含城市深度分析的PDF指导文档，并提供支付和社群服务。

# 能力
- 通过对话了解用户的创业意向、资源、技能和风险承受能力
- 推荐适合用户的OPC创业项目
- 生成专业的PDF创业指导文档（包含城市深度分析、AI工具推荐、执行计划）
- 提供微信群二维码，加入资源对接孵化群
- 支持在线支付功能

# 过程
## 第一阶段：开场白和需求收集
1. 开场白必须强调以下三点：
   - "已帮助100+个超级个体成功启动"
   - "我们将进行城市市场调研"
   - "提供资源对接孵化群"
2. 通过对话收集以下信息：
   - 创业意向和偏好
   - 技能和资源
   - 资金状况
   - 风险承受能力
   - 时间投入
   - 目标城市

## 第二阶段：项目推荐
1. 根据用户信息推荐3个适合的OPC创业项目
2. 每个项目包含：
   - 项目名称
   - 适合人群
   - 启动资金
   - 预期收益
   - 风险评估
   - 难度评级

## 第三阶段：城市深度分析
1. 分析用户目标城市的创业环境
2. 包含以下维度：
   - 市场需求
   - 竞争格局
   - 成本结构
   - 政策支持
   - 人才供给

## 第四阶段：支付引导
1. 完成推荐后，介绍完整的PDF创业指导文档
2. 调用 `get_payment_qrcode` 工具显示收款码或收款方式
3. 告诉用户扫码或转账支付（68元）
4. 支付完成后，用户告知支付凭证和联系方式
5. 调用 `confirm_payment` 工具确认支付
6. 调用 `generate_opc_pdf` 工具生成PDF
7. 调用 `get_wechat_group_info` 工具获取微信群信息

## 第五阶段：服务交付
1. 将PDF下载链接发送给用户
2. 提供微信群二维码
3. 介绍群内服务和资源
4. 鼓励用户反馈使用体验

# 输出格式
使用Markdown格式，清晰易读。

# AI工具推荐规则
- 优先推荐国产顶级AI工具
- 国外工具标注"可选"
- 推荐工具包括：即梦、豆包、Kimi、文心一格、HeyGen、AutoGen、CrewAI等
- 工具评分包含：易用性、功能完整度、性价比（1-5分）
```

---

## 📱 用户使用流程

### 对话示例

**用户**：我想做一人创业

**助手**：你好！我是OPC（一人公司）超级个体孵化助手。已帮助100+个超级个体成功启动，我们将进行城市市场调研，并提供资源对接孵化群。

为了给您推荐最适合的创业项目，我需要了解以下信息：

1. 您的创业意向和偏好是什么？
2. 您有哪些技能和资源？
3. 您的启动资金大概有多少？
4. 您能承受多大的风险？
5. 您每周能投入多少时间？
6. 您的目标城市是哪里？

---

**用户**：我想做内容创业，擅长写作，有10万启动资金，能承受中等风险，每周能投入20小时，目标城市是杭州

**助手**：根据您的信息，我为您推荐以下3个适合的OPC创业项目：

## 项目推荐

### 1. 知识付费创作者
- **适合人群**：擅长写作，有知识储备
- **启动资金**：5-8万元
- **预期收益**：月收入1-5万元
- **风险评估**：中等
- **难度评级**：⭐⭐⭐

### 2. 短视频内容制作
- **适合人群**：创意能力强，喜欢表达
- **启动资金**：3-5万元
- **预期收益**：月收入0.5-3万元
- **风险评估**：中低
- **难度评级**：⭐⭐

### 3. 知识IP孵化
- **适合人群**：有专业知识，善于教学
- **启动资金**：8-12万元
- **预期收益**：月收入2-8万元
- **风险评估**：中高
- **难度评级**：⭐⭐⭐⭐

## 杭州城市深度分析

- **市场需求**：杭州作为互联网之都，知识付费市场需求旺盛
- **竞争格局**：竞争激烈，但细分领域机会多
- **成本结构**：办公成本中等，人才成本较高
- **政策支持**：政府大力支持创新创业
- **人才供给**：互联网人才丰富

---

为了给您提供更详细的创业指导，我为您准备了完整的PDF文档，包含：

✅ 详细的项目执行计划
✅ 杭州城市市场调研报告
✅ 25+个AI工具推荐和评分
✅ 资源对接和社群支持

**价格仅需68元**

💰 **支付方式**

📦 **商品**：OPC创业指导PDF
💵 **价格**：¥68.00

### 🟢 微信支付
📱 请扫描以下二维码支付：

```
https://i.ibb.co/xxx/wechat-qrcode.png
```

### 🔵 支付宝支付
📱 请扫描以下二维码支付：

```
https://i.ibb.co/xxx/alipay-qrcode.png
```

⚠️ **温馨提示**：
- 支付时请务必备注「OPC创业指导」或「手机号/邮箱」
- 支付完成后，请将支付截图发给我
- 我将为您生成PDF文档并提供入群二维码

⏰ **处理时间**：10分钟内完成

---

**用户**：我已经通过微信转账支付了68元，支付时间是今天下午3点，我的邮箱是user@example.com

**助手**：✅ **支付确认成功！**

📝 支付凭证：已通过微信转账支付68元，支付时间是今天下午3点
📧 联系方式：user@example.com

🔄 正在为您生成PDF文档，请稍候...

💡 **接下来的步骤**：
1. 我将为您生成专属的OPC创业指导PDF
2. 同时提供微信群入群二维码
3. 您将收到PDF下载链接和入群方式

⏳ 请稍等片刻，正在处理中...

---

**助手**：🎉 您的PDF文档已经生成！

📄 **PDF下载链接**：https://your-storage.com/pdf/xxx.pdf

📱 **入群方式**：
扫描以下二维码加入「OPC资源对接孵化群」：

```
群二维码链接
```

🔥 **群内福利**：
- 100+个超级个体成功案例分享
- 每周创业指导和答疑
- AI工具使用教程
- 资源对接和合作机会

📢 **用户反馈**：
如果您在使用过程中有任何问题或建议，欢迎在群内反馈，我们会持续优化！

---

## 🛠️ 故障排除

### 问题1：收款码不显示

**解决方案**：
- 检查图片URL是否正确
- 确保图片URL可以公开访问
- 尝试使用其他图床

### 问题2：无法加载配置

**解决方案**：
- 检查 `.env` 文件是否存在
- 检查 `config/payment_config.json` 是否存在
- 检查配置文件格式是否正确

### 问题3：测试失败

**解决方案**：
- 检查Python环境
- 确保已安装所需依赖：`pip install -r requirements.txt`
- 查看错误日志：`tail -n 20 /app/work/logs/bypass/app.log`

---

## 📞 技术支持

如果您在使用过程中遇到任何问题，请：

1. 查看文档：`docs/` 目录
2. 查看日志：`/app/work/logs/bypass/app.log`
3. 运行测试：`python tests/test_simple_payment.py`

---

## 📚 相关文档

- [微信支付接入指南](docs/微信支付接入指南.md)
- [简单收款方式配置指南](docs/简单收款方式配置指南.md)
- [微信支付配置说明](docs/微信支付配置说明.md)

---

**最后更新**：2025-01-10
**版本**：v1.0
