# ðŸš€ å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆ5åˆ†é’Ÿå®Œæˆï¼‰

æœ¬æŒ‡å—å¸®åŠ©ä½ å¿«é€Ÿå°†OPC Agentéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ã€‚

---

## ðŸ“‹ å‰ææ¡ä»¶

- âœ… å·²è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
- âœ… æœåŠ¡å™¨ç³»ç»Ÿï¼šUbuntu 20.04 æˆ– 22.04
- âœ… æœ¬åœ°ç”µè„‘å·²å®‰è£…SSHå®¢æˆ·ç«¯
- âœ… å·²å®Œæˆ `.env` æ–‡ä»¶é…ç½®

---

## âš¡ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šè¿žæŽ¥æœåŠ¡å™¨

```bash
ssh root@ä½ çš„æœåŠ¡å™¨å…¬ç½‘IP
# è¾“å…¥å¯†ç 
```

### æ­¥éª¤2ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ**ï¼š

```bash
# æ–¹å¼1ï¼šä½¿ç”¨SCPï¼ˆæŽ¨èï¼‰
scp -r /workspace/projects/* root@ä½ çš„æœåŠ¡å™¨IP:/opt/opc-agent/

# æ–¹å¼2ï¼šå¦‚æžœä½ åœ¨æœ¬åœ°ï¼Œç›´æŽ¥å¤åˆ¶æ–‡ä»¶
# ä½¿ç”¨WinSCPã€FileZillaç­‰å·¥å…·ä¸Šä¼ 
```

### æ­¥éª¤3ï¼šè¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**ï¼š

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /opt/opc-agent
cd /opt/opc-agent

# ä¸Šä¼ æ–‡ä»¶åŽï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la

# è¿è¡Œéƒ¨ç½²è„šæœ¬
chmod +x scripts/deploy.sh
./scripts/deploy.sh
```

### æ­¥éª¤4ï¼šé…ç½®çŽ¯å¢ƒå˜é‡

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**ï¼š

```bash
cd /opt/opc-agent
nano .env
```

å¡«å†™é…ç½®ï¼š
```bash
WECHAT_QRCODE_URL=https://ibb.co/0y0jXhCv
WECHAT_GROUP_QRCODE_URL=https://ibb.co/PZrnNCT2
PAYMENT_PRICE=68.00
PRODUCT_NAME=OPCåˆ›ä¸šæŒ‡å¯¼PDF
```

ä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl+Xï¼ŒYï¼ŒEnterï¼‰ã€‚

### æ­¥éª¤5ï¼šé‡å¯æœåŠ¡

```bash
supervisorctl restart opc-agent
```

### æ­¥éª¤6ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
supervisorctl status

# æµ‹è¯•æœåŠ¡
curl http://localhost:8080/api/health
```

### æ­¥éª¤7ï¼šè®¿é—®æœåŠ¡

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
```
http://ä½ çš„æœåŠ¡å™¨å…¬ç½‘IP:8080
```

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

å¦‚æžœä½ çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜Žéƒ¨ç½²æˆåŠŸï¼š

1. âœ… æœåŠ¡çŠ¶æ€æ˜¾ç¤º `RUNNING`
2. âœ… å¥åº·æ£€æŸ¥è¿”å›ž `{"status": "ok"}`
3. âœ… å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡
4. âœ… æµ‹è¯•èŠå¤©åŠŸèƒ½æ­£å¸¸

---

## ðŸŽ¯ æŽ¨èé…ç½®

### æœ€ä½Žé…ç½®ï¼ˆæµ‹è¯•ç”¨ï¼‰
- CPUï¼š1æ ¸
- å†…å­˜ï¼š2GB
- å¸¦å®½ï¼š1Mbps
- ä»·æ ¼ï¼šçº¦30-50å…ƒ/æœˆ

### æŽ¨èé…ç½®ï¼ˆç”Ÿäº§ç”¨ï¼‰
- CPUï¼š2æ ¸
- å†…å­˜ï¼š4GB
- å¸¦å®½ï¼š3Mbps
- ä»·æ ¼ï¼šçº¦60-100å…ƒ/æœˆ

### äº‘æœåŠ¡å•†æŽ¨è

| æœåŠ¡å•† | é…ç½® | ä»·æ ¼ | è´­ä¹°é“¾æŽ¥ |
|--------|------|------|---------|
| é˜¿é‡Œäº‘ | 2æ ¸2G | Â¥60/æœˆ | https://www.aliyun.com/product/swas |
| è…¾è®¯äº‘ | 2æ ¸2G | Â¥50/æœˆ | https://cloud.tencent.com/product/lighthouse |
| åŽä¸ºäº‘ | 2æ ¸2G | Â¥60/æœˆ | https://www.huaweicloud.com/product/hecs |

---

## ðŸ”§ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
supervisorctl status

# é‡å¯æœåŠ¡
supervisorctl restart opc-agent

# åœæ­¢æœåŠ¡
supervisorctl stop opc-agent

# å¯åŠ¨æœåŠ¡
supervisorctl start opc-agent
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/opc-agent.out.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/opc-agent.err.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
tail -n 100 /var/log/opc-agent.out.log
```

### é…ç½®æ›´æ–°

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano /opt/opc-agent/.env

# é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
supervisorctl restart opc-agent
```

---

## â“ å¸¸è§é—®é¢˜

### Q1ï¼šè¿žæŽ¥æœåŠ¡å™¨å¤±è´¥

**A**ï¼šæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- ç¡®è®¤æœåŠ¡å™¨å…¬ç½‘IPæ­£ç¡®
- ç¡®è®¤æœåŠ¡å™¨å®‰å…¨ç»„å·²å¼€æ”¾SSHç«¯å£ï¼ˆ22ï¼‰
- ç¡®è®¤å¯†ç æ­£ç¡®

### Q2ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

**A**ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š
```bash
tail -f /var/log/opc-agent.err.log
```

å¸¸è§åŽŸå› ï¼š
- ä¾èµ–æœªå®‰è£…ï¼šé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
- .envé…ç½®é”™è¯¯ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
- ç«¯å£è¢«å ç”¨ï¼šä¿®æ”¹ç«¯å£æˆ–åœæ­¢å ç”¨è¿›ç¨‹

### Q3ï¼šæ— æ³•è®¿é—®æœåŠ¡

**A**ï¼šæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`supervisorctl status`
- é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£ï¼š`ufw status`
- å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾8080ç«¯å£ï¼ˆäº‘æœåŠ¡å•†æŽ§åˆ¶å°ï¼‰

### Q4ï¼šå¦‚ä½•æ›´æ–°ä»£ç 

**A**ï¼š
```bash
# ä¸Šä¼ æ–°ä»£ç åˆ°æœåŠ¡å™¨
cd /opt/opc-agent

# é‡å¯æœåŠ¡
supervisorctl restart opc-agent
```

---

## ðŸŒ é…ç½®åŸŸåå’ŒHTTPSï¼ˆå¯é€‰ï¼‰

### æ­¥éª¤1ï¼šè´­ä¹°åŸŸå

åœ¨é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å¹³å°è´­ä¹°åŸŸåã€‚

### æ­¥éª¤2ï¼šé…ç½®DNSè§£æž

åœ¨åŸŸåç®¡ç†åŽå°æ·»åŠ Aè®°å½•ï¼š
```
ç±»åž‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘IP
```

### æ­¥éª¤3ï¼šå®‰è£…SSLè¯ä¹¦

```bash
# å®‰è£…certbot
apt install certbot python3-certbot-nginx -y

# èŽ·å–è¯ä¹¦ï¼ˆæ›¿æ¢ä½ çš„åŸŸåï¼‰
certbot --nginx -d your-domain.com
```

### æ­¥éª¤4ï¼šè®¿é—®HTTPS

```
https://your-domain.com
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š[éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md)

---

## ðŸ“Š ç›‘æŽ§å»ºè®®

### æ¯æ—¥æ£€æŸ¥
- [ ] æœåŠ¡çŠ¶æ€æ­£å¸¸
- [ ] é”™è¯¯æ—¥å¿—æ— å¼‚å¸¸
- [ ] å¤„ç†è®¢å•åŠæ—¶

### æ¯å‘¨æ£€æŸ¥
- [ ] ä¼ä¸šå¾®ä¿¡ç¾¤äºŒç»´ç æœ‰æ•ˆæœŸ
- [ ] æ”¶æ¬¾ç æ˜¯å¦æ­£å¸¸
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†

### æ¯æœˆæ£€æŸ¥
- [ ] ç³»ç»Ÿæ›´æ–°
- [ ] å¤‡ä»½é‡è¦æ•°æ®
- [ ] ä¼˜åŒ–é…ç½®

---

## ðŸ’¡ æœ€ä½³å®žè·µ

### 1. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d)
tar -czf /backup/opc-agent-$DATE.tar.gz /opt/opc-agent
find /backup -name "opc-agent-*.tar.gz" -mtime +7 -delete
EOF

chmod +x /opt/backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ ï¼š0 3 * * * /opt/backup.sh
```

### 2. æ—¥å¿—è½®è½¬

```bash
# åˆ›å»ºlogrotateé…ç½®
cat > /etc/logrotate.d/opc-agent << 'EOF'
/var/log/opc-agent*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
}
EOF
```

### 3. ç›‘æŽ§å‘Šè­¦

å»ºè®®é…ç½®ç›‘æŽ§å‘Šè­¦ï¼Œå¦‚ï¼š
- æœåŠ¡ä¸‹çº¿å‘Šè­¦
- é”™è¯¯æ—¥å¿—å‘Šè­¦
- ç£ç›˜ç©ºé—´å‘Šè­¦

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

### æ–‡æ¡£
- [å®Œæ•´éƒ¨ç½²æŒ‡å—](./éƒ¨ç½²æŒ‡å—.md)
- [é…ç½®å®Œæˆæ€»ç»“](./é…ç½®å®Œæˆæ€»ç»“.md)
- [æ”¶æ¬¾åŠŸèƒ½ä½¿ç”¨æŒ‡å—](./æ”¶æ¬¾åŠŸèƒ½ä½¿ç”¨æŒ‡å—.md)

### æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨
- [ ] å·²ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
- [ ] å·²é…ç½®.envæ–‡ä»¶
- [ ] å·²æµ‹è¯•æœ¬åœ°è¿è¡Œ

éƒ¨ç½²åŽæ£€æŸ¥ï¼š
- [ ] æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å¯ä»¥è®¿é—®æœåŠ¡
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ—¥å¿—æ— é”™è¯¯

---

**é¢„è®¡éƒ¨ç½²æ—¶é—´ï¼š5-10åˆ†é’Ÿ**

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼** ðŸš€
